const app = require('./app');
const connectDB = require('./config/db');
const { port, nodeEnv } = require('./config/env');

// Connect to database
connectDB();

// Start server
const server = app.listen(port, () => {
  console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë   üöÄ Imperium Server Starting...     ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
  
  üì° Server running in ${nodeEnv} mode
  üåê Port: ${port}
  üîó URL: http://localhost:${port}
  üíö Health: http://localhost:${port}/health
  
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë   Available Endpoints:               ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë   üîê Admin Authentication:           ‚ïë
‚ïë   POST   /api/admin/login            ‚ïë
‚ïë   POST   /api/admin/forgot-password  ‚ïë
‚ïë   POST   /api/admin/reset-password/:token    ‚ïë
‚ïë                                      ‚ïë
‚ïë   üìù Admin Content Management:       ‚ïë
‚ïë   GET/PUT   /api/admin/content/home-hero    ‚ïë
‚ïë   CRUD      /api/admin/content/core-offerings    ‚ïë
‚ïë   GET/PUT   /api/admin/content/about-us    ‚ïë
‚ïë   CRUD      /api/admin/content/leadership    ‚ïë
‚ïë   CRUD      /api/admin/content/services    ‚ïë
‚ïë                                      ‚ïë
‚ïë   üåê Public Content (No Auth):       ‚ïë
‚ïë   GET    /api/content/home           ‚ïë
‚ïë   GET    /api/content/about          ‚ïë
‚ïë   GET    /api/content/services       ‚ïë
‚ïë   GET    /api/content/all            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
  `);
});

// Handle unhandled promise rejections
process.on('unhandledRejection', (err) => {
  console.error(`‚ùå Unhandled Rejection: ${err.message}`);
  console.error(err.stack);
  // Close server & exit process
  server.close(() => process.exit(1));
});

// Handle uncaught exceptions
process.on('uncaughtException', (err) => {
  console.error(`‚ùå Uncaught Exception: ${err.message}`);
  console.error(err.stack);
  process.exit(1);
});
